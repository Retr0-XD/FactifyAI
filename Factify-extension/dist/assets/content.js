/* empty css      */function a(...t){console.log("[FactifyAI Content]",...t)}function m(t,e,o){const i=document.getElementById("factify-floating-button");i&&document.body.removeChild(i);const n=document.createElement("div");n.id="factify-floating-button",n.innerHTML="Factify",n.style.position="absolute",n.style.left=`${e}px`,n.style.top=`${o}px`,n.style.zIndex="9999",n.style.backgroundColor="#4285f4",n.style.color="white",n.style.padding="8px 12px",n.style.borderRadius="4px",n.style.cursor="pointer",n.style.boxShadow="0 2px 5px rgba(0,0,0,0.2)",n.addEventListener("click",()=>{a("Factify button clicked"),g(t),document.body.removeChild(n)}),document.body.appendChild(n),a("Floating button created for text:",t.substring(0,50)+(t.length>50?"...":""))}function y(){const t=window.getSelection();if(t&&!t.isCollapsed){const e=t.toString().trim();if(e.length>0){const i=t.getRangeAt(0).getBoundingClientRect(),n=i.left+window.scrollX+i.width/2,c=i.bottom+window.scrollY+10;a("Text selected:",e.substring(0,50)+(e.length>50?"...":"")),m(e,n,c)}}}function g(t){a("Starting text analysis process"),chrome.storage.sync.get(["apiKey","model","enableOptions"],e=>{if(a("Retrieved storage settings:",{hasApiKey:!!e.apiKey,model:e.model||"default",enableOptions:e.enableOptions}),!e.apiKey){r("Please set your API key in the extension settings (click the extension icon in toolbar)");return}const o={text:t,enableOptions:e.enableOptions||{factCheck:!0,sentimentAnalysis:!1},apikey:e.apiKey,model:e.model||"default-model"};l(),a("Sending message to background script");const i=setTimeout(()=>{s(),r("Request timed out. Please try again or check your connection."),a("Message request timed out")},3e4);try{chrome.runtime.sendMessage({action:"analyzeText",data:o},n=>{if(clearTimeout(i),s(),chrome.runtime.lastError){a("Chrome runtime error:",chrome.runtime.lastError),r(`Extension error: ${chrome.runtime.lastError.message}`);return}a("Received response from background:",n),n&&n.success?u(n.data||""):r(`Error: ${(n==null?void 0:n.error)||"Unknown error occurred. Please try again."}`)})}catch(n){clearTimeout(i),s(),a("Exception during sendMessage:",n),r(`Error: ${n instanceof Error?n.message:"Unknown error"}`)}})}function f(t){chrome.storage.sync.get(["apiKey","model"],e=>{if(!e.apiKey){r("Please set your API key in the extension settings");return}const o=document.createElement("canvas");o.width=t.naturalWidth,o.height=t.naturalHeight;const i=o.getContext("2d");if(!i){r("Failed to create canvas context");return}i.drawImage(t,0,0),o.toBlob(n=>{if(!n){r("Failed to convert image");return}const c={imageData:n,apikey:e.apiKey,model:e.model||"default-model",text:"Analyze this image for factual content"};l(),chrome.runtime.sendMessage({action:"analyzeImage",data:c},d=>{s(),d&&d.success?u(d.data||""):r(`Error: ${(d==null?void 0:d.error)||"Unknown error"}`)})},"image/jpeg",.8)})}function l(){const t=document.createElement("div");t.id="factify-loader",t.innerHTML="Analyzing...",t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.backgroundColor="#fff",t.style.padding="20px",t.style.borderRadius="8px",t.style.boxShadow="0 2px 10px rgba(0,0,0,0.2)",t.style.zIndex="10000",document.body.appendChild(t)}function s(){const t=document.getElementById("factify-loader");t&&document.body.removeChild(t)}function r(t){a("Showing notification:",t);const e=document.createElement("div");e.id="factify-notification",e.innerHTML=t,e.style.position="fixed",e.style.bottom="20px",e.style.right="20px",e.style.backgroundColor="#333",e.style.color="#fff",e.style.padding="10px 15px",e.style.borderRadius="4px",e.style.zIndex="10000",e.style.maxWidth="300px",e.style.boxShadow="0 2px 10px rgba(0,0,0,0.2)";const o=document.getElementById("factify-notification");o&&document.body.removeChild(o),document.body.appendChild(e),setTimeout(()=>{e.parentNode&&document.body.removeChild(e)},5e3)}function u(t){const e=document.createElement("div");e.id="factify-results-modal",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0,0,0,0.7)",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="10000";const o=document.createElement("div");o.style.backgroundColor="#fff",o.style.borderRadius="8px",o.style.padding="20px",o.style.maxWidth="80%",o.style.maxHeight="80%",o.style.overflowY="auto";const i=document.createElement("button");i.innerHTML="X",i.style.float="right",i.style.border="none",i.style.background="none",i.style.fontSize="20px",i.style.cursor="pointer",i.onclick=()=>document.body.removeChild(e);const n=document.createElement("div");try{const c=JSON.parse(t);n.innerHTML=`<h2>Fact Check Results</h2><pre>${JSON.stringify(c,null,2)}</pre>`}catch{n.innerHTML=`<h2>Fact Check Results</h2><div>${t}</div>`}o.appendChild(i),o.appendChild(n),e.appendChild(o),document.body.appendChild(e),e.addEventListener("click",c=>{c.target===e&&document.body.removeChild(e)})}function h(){a("FactifyAI content script initialized"),document.addEventListener("mouseup",y),chrome.runtime.onMessage.addListener((t,e,o)=>{if(a("Received message in content script:",t),t.action==="contextMenuClick"&&t.target==="image"){const i=document.querySelector(`img[src="${t.srcUrl}"]`);i&&f(i)}return o({success:!0}),!0});try{a("Testing communication with background script"),chrome.runtime.sendMessage({action:"checkHealth"},t=>{chrome.runtime.lastError?a("Error communicating with background script:",chrome.runtime.lastError):a("Communication with background script successful",t)})}catch(t){a("Exception during background script communication test:",t)}}h();
